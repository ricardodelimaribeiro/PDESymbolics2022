(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     27617,        687]
NotebookOptionsPosition[     25996,        658]
NotebookOutlinePosition[     26389,        674]
CellTagsIndexPosition[     26346,        671]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{
  "Get", "[", 
   "\"\</Users/ribeirrd/eclipse-workspace/PDESymbolics2022/PDESymbolics2022/\
PDESymbolics2022.m\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.890369576953856*^9, 3.89036959397898*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"f029474b-9f4c-422a-95f2-3b33fb52c3c6"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseMap", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseMap\\\\\\\"\\\"}]\\) \
appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 1, 32159192755798492331, "Local", 
   "PDESymbolics2022`PiecewiseMap"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594536559*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"44c99d28-9ba9-438f-8fcf-08f85bc543db"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseOperatorMap", "shdw", 
   "\"Symbol \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseOperatorMap\\\\\\\"\\\"}]\\) appears in \
multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 2, 32159192755798492331, "Local", 
   "PDESymbolics2022`PiecewiseOperatorMap"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594565804*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"7e9a0d98-ab06-4123-9d09-4e80f10500cb"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseBeautifyOperator", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseBeautifyOperator\\\\\\\"\\\
\"}]\\) appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"\
\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"Global`\\\\\\\"\
\\\"}], \\\"}\\\"}]\\); definitions in context \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or \
be shadowed by other definitions.\"", 2, 20, 3, 32159192755798492331, "Local",
    "PDESymbolics2022`PiecewiseBeautifyOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.89036959458046*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"319149a0-bae3-43ee-a253-1f7f8c994415"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseListClean", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseListClean\\\\\\\"\\\"}]\\) \
appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 4, 32159192755798492331, "Local", 
   "PDESymbolics2022`PiecewiseListClean"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594604703*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"7456e43e-e6be-4447-8465-775b8ea6a91a"],

Cell[BoxData[
 TemplateBox[{
  "InferGeneratorsOperator", "shdw", 
   "\"Symbol \
\\!\\(\\*RowBox[{\\\"\\\\\\\"InferGeneratorsOperator\\\\\\\"\\\"}]\\) appears \
in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 5, 32159192755798492331, "Local", 
   "PDESymbolics2022`InferGeneratorsOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594636405*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"f4236674-56a7-402b-a286-26e22e700b33"],

Cell[BoxData[
 TemplateBox[{
  "LeadingCoefficientOperator", "shdw", 
   "\"Symbol \
\\!\\(\\*RowBox[{\\\"\\\\\\\"LeadingCoefficientOperator\\\\\\\"\\\"}]\\) \
appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 6, 32159192755798492331, "Local", 
   "PDESymbolics2022`LeadingCoefficientOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594660906*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"30927003-f1d2-4939-bed8-62a479b16b13"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseSPolynomialOperator", "shdw", 
   "\"Symbol \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseSPolynomialOperator\\\\\\\"\\\"}]\\) \
appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 7, 32159192755798492331, "Local", 
   "PDESymbolics2022`PiecewiseSPolynomialOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594684005*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"7e0a795a-2804-4399-9497-8747006abf79"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseDivisionOperator", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseDivisionOperator\\\\\\\"\\\
\"}]\\) appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"\
\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"Global`\\\\\\\"\
\\\"}], \\\"}\\\"}]\\); definitions in context \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or \
be shadowed by other definitions.\"", 2, 20, 8, 32159192755798492331, "Local",
    "PDESymbolics2022`PiecewiseDivisionOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594697657*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"de29645d-88d9-4b52-bb69-53d68ad26a13"],

Cell[BoxData[
 TemplateBox[{
  "AutoReduceOperator", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"AutoReduceOperator\\\\\\\"\\\"}]\\) \
appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 9, 32159192755798492331, "Local", 
   "PDESymbolics2022`AutoReduceOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.8903695947193623`*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"91757e17-0755-4e42-bd42-5429731b15a9"],

Cell[BoxData[
 TemplateBox[{
  "PiecewisePolynomialReduceRemainderOperator", "shdw", 
   "\"Symbol \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewisePolynomialReduceRemainderOperator\\\\\\\
\"\\\"}]\\) appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\
\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"Global`\\\\\
\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \
\\!\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or \
be shadowed by other definitions.\"", 2, 20, 10, 32159192755798492331, 
   "Local", "PDESymbolics2022`PiecewisePolynomialReduceRemainderOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594743978*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"d28b707f-c315-47ed-9495-bd3229098cf9"],

Cell[BoxData[
 TemplateBox[{
  "PiecewiseApplyConditionOperator", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"PiecewiseApplyConditionOperator\\\\\
\\\"\\\"}]\\) appears in multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 11, 32159192755798492331, "Local", 
   "PDESymbolics2022`PiecewiseApplyConditionOperator"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594767025*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"f22fa49c-27b2-4725-92e9-f2b09bad2814"],

Cell[BoxData[
 TemplateBox[{
  "GrobOp", "shdw", 
   "\"Symbol \\!\\(\\*RowBox[{\\\"\\\\\\\"GrobOp\\\\\\\"\\\"}]\\) appears in \
multiple contexts \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\", \\\",\\\", \
\\\"\\\\\\\"Global`\\\\\\\"\\\"}], \\\"}\\\"}]\\); definitions in context \\!\
\\(\\*RowBox[{\\\"\\\\\\\"PDESymbolics2022`\\\\\\\"\\\"}]\\) may shadow or be \
shadowed by other definitions.\"", 2, 20, 12, 32159192755798492331, "Local", 
   "PDESymbolics2022`GrobOp"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.890369594776146*^9},
 CellLabel->
  "During evaluation of \
In[20]:=",ExpressionUUID->"ab33739a-bb5c-4012-99e6-2bd762b213ab"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "GrobOp", "]"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hasFailed", "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"MemberQ", "[", "$Failed", "]"}], "[", "x", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hasZero", "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"MemberQ", "[", "0", "]"}], "[", "x", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hasOne", "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"MemberQ", "[", "1", "]"}], "[", "x", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{"x_List", ",", "y_List"}], "}"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"GrobOp", "[", "variables", "]"}], "[", 
     RowBox[{"x", ",", "y"}], "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"{", "}"}], "]"}], "=", 
    RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"_", ",", 
      RowBox[{"_", "?", "hasFailed"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"EchoLabel", "[", "\"\<checking...\>\"", "]"}], "@", 
     "$Failed"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"_", ",", "$Failed"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"EchoLabel", "[", "\"\<checking... 2\>\"", "]"}], "@", 
     "$Failed"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{
      RowBox[{"_", "?", "hasFailed"}], ",", "_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"EchoLabel", "[", "\"\<checking... 3\>\"", "]"}], "$Failed"}]}], 
   ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"$Failed", ",", "_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"EchoLabel", "[", "\"\<checking... 4\>\"", "]"}], "@", 
     "$Failed"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", "$Failed", "]"}], ":=", 
    "$Failed"}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"x_", "?", "hasZero"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"GrobOp", "[", "variables", "]"}], "[", 
     RowBox[{
      RowBox[{"DeleteCases", "[", "0", "]"}], "[", "x", "]"}], "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{
      RowBox[{"x_", "?", "hasZero"}], ",", "y_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"GrobOp", "[", "variables", "]"}], "[", 
     RowBox[{
      RowBox[{
       RowBox[{"DeleteCases", "[", "0", "]"}], "[", "x", "]"}], ",", "y"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"x_", ",", 
      RowBox[{"y_", "?", "hasZero"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"GrobOp", "[", "variables", "]"}], "[", 
     RowBox[{"x", ",", 
      RowBox[{
       RowBox[{"DeleteCases", "[", "0", "]"}], "[", "y", "]"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"_", ",", 
      RowBox[{"_", "?", "hasOne"}]}], "]"}], ":=", 
    RowBox[{"{", "1", "}"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{
      RowBox[{"_", "?", "hasOne"}], ",", "_"}], "]"}], ":=", 
    RowBox[{"{", "1", "}"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"_", "?", "hasOne"}], "]"}], ":=", 
    RowBox[{"{", "1", "}"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobOp", "[", "variables_", "]"}], "[", 
     RowBox[{"grobner_List", ",", 
      RowBox[{"{", "}"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "facts", "}"}], ",", 
      RowBox[{
       RowBox[{"facts", "=", 
        RowBox[{"Simplify", "@", 
         RowBox[{"Lookup", "[", 
          RowBox[{"variables", ",", "\"\<facts\>\"", ",", "True"}], "]"}]}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"facts", "===", "False"}], ",", "$Failed", ",", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<final: facts: \>\"", ",", "facts", ",", 
             "\"\<\\tfinal: expanded: \>\"", ",", "grobner"}], "]"}], ";"}], 
          "*)"}], 
         RowBox[{
          RowBox[{
           RowBox[{"AutoReduceOperator", "[", "variables", "]"}], "[", 
           "grobner", "]"}], "//", "PiecewiseExpand"}]}], "]"}]}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GrobO", "[", "variables_", "]"}], "[", 
     RowBox[{"preGrobner_List", ",", "sPolynomials_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"facts", ",", "fstSPoly", ",", "lc", ",", 
        RowBox[{"newPreGrobner", "=", "preGrobner"}], ",", "reduced", ",", 
        "newArgs", ",", "newSPolynomials", ",", "generators"}], 
       RowBox[{"(*", 
        RowBox[{",", "depVars", ",", "indVars", ",", "vars"}], "*)"}], "}"}], 
      ",", 
      RowBox[{
       RowBox[{"facts", "=", 
        RowBox[{"Simplify", "@", 
         RowBox[{"Lookup", "[", 
          RowBox[{"variables", ",", "\"\<facts\>\"", ",", "True"}], "]"}]}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Reduce", "[", "facts", "]"}], "===", "False"}], ",", 
         "$Failed", ",", 
         RowBox[{
          RowBox[{"fstSPoly", "=", 
           RowBox[{"First", "@", "sPolynomials"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"fstSPoly", "=", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"EchoLabel", "[", "\"\<GrobOp2: monic S poly\>\"", "]"}],
              "@"}], "*)"}], 
           RowBox[{
            RowBox[{"MonicOperator", "[", "variables", "]"}], "[", "fstSPoly",
             "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{
            "EchoLabel", "[", "\"\<GrobOp2: S poly reduced\>\"", "]"}], "@", 
            RowBox[{
             RowBox[{
             "PiecewisePolynomialReduceRemainderOperator", "[", "variables", 
              "]"}], "[", 
             RowBox[{"fstSPoly", ",", "newPreGrobner"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{
            "EchoLabel", "[", "\"\<GrobOp2: monic S poly reduced\>\"", "]"}], 
            "@", 
            RowBox[{
             RowBox[{"MonicOperator", "[", "variables", "]"}], "[", "reduced",
              "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"fstSPoly", "=", 
           RowBox[{"Simplify", "[", 
            RowBox[{"First", "@", "sPolynomials"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"lc", "=", 
           RowBox[{
            RowBox[{"LeadingCoefficientOperator", "[", "variables", "]"}], 
            "[", "fstSPoly", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"fstSPoly", "=", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "PiecewiseEliminateEqualitiesOperator", "[", "variables", "]"}], 
             "@"}], "*)"}], 
           RowBox[{
            RowBox[{
             RowBox[{"PiecewiseDivisionOperator", "[", "variables", "]"}], 
             "[", 
             RowBox[{"fstSPoly", ",", "lc"}], "]"}], "//", "Expand"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{
            "PiecewisePolynomialReduceRemainderOperator", "[", "variables", 
             "]"}], "[", 
            RowBox[{"fstSPoly", ",", "newPreGrobner"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"lc", "=", 
           RowBox[{
            RowBox[{"LeadingCoefficientOperator", "[", "variables", "]"}], 
            "[", "reduced", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{"PiecewiseDivisionOperator", "[", "variables", "]"}], "[", 
            RowBox[{"reduced", ",", "lc"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"generators", "=", 
           RowBox[{
            RowBox[{"InferGeneratorsOperator", "[", "variables", "]"}], "[", 
            "reduced", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{"PiecewiseMap", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Total", "@", 
                RowBox[{"Simplify", "@", 
                 RowBox[{"MonomialList", "[", 
                  RowBox[{"#", ",", "generators"}], "]"}]}]}], "&"}], ",", 
              "reduced"}], "]"}], "//", 
            RowBox[{"PiecewiseBeautifyOperator", "[", "variables", "]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"reduced", "=", 
           RowBox[{
            RowBox[{
            "PiecewiseApplyConditionOperator", "[", "variables", "]"}], "[", 
            "reduced", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "reduced", "]"}], "===", "Piecewise"}], ",", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"replace", " ", "the", " ", "first", " ", "S"}], "-", 
              RowBox[{
              "polynomial", " ", "by", " ", "the", " ", "cases", " ", "of", 
               " ", "the", " ", "S"}], "-", 
              RowBox[{"polynomial", "."}]}], "*)"}], 
            RowBox[{"newArgs", "=", 
             RowBox[{"PiecewiseMap", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"newPreGrobner", ",", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{
                    RowBox[{"Prepend", "[", "#", "]"}], "[", 
                    RowBox[{"Rest", "@", "sPolynomials"}], "]"}], "]"}]}], 
                   "}"}], "//", "Expand"}], ")"}], "&"}], ",", "reduced"}], 
              "]"}]}], ",", 
            RowBox[{"reduced", "===", "0"}], ",", 
            RowBox[{"(*", 
             RowBox[{
             "this", " ", "is", " ", "the", " ", "most", " ", "effective", 
              " ", 
              RowBox[{"choice", "!"}]}], "*)"}], 
            RowBox[{"newArgs", "=", 
             RowBox[{"{", 
              RowBox[{"newPreGrobner", ",", 
               RowBox[{"Rest", "[", "sPolynomials", "]"}]}], "}"}]}], ",", 
            "True", ",", 
            RowBox[{
             RowBox[{"newSPolynomials", "=", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                 "PiecewiseSPolynomialOperator", "[", "variables", "]"}], "[", 
                 RowBox[{"reduced", ",", "#"}], "]"}], "&"}], "/@", 
               "newPreGrobner"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Using", " ", "Union", " ", "to", " ", 
               RowBox[{"DeleteDuplicates", "!"}], " ", "is", " ", "there", 
               " ", "a", " ", "better", " ", 
               RowBox[{"choice", "?"}]}], "*)"}], 
             RowBox[{"newSPolynomials", "=", 
              RowBox[{"PiecewiseMap", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Simplify", "[", 
                  RowBox[{"Expand", "@", 
                   RowBox[{"(*", "Full", "*)"}], 
                   RowBox[{"Simplify", "@", "#"}]}], "]"}], "&"}], ",", 
                RowBox[{
                 RowBox[{"Union", "[", 
                  RowBox[{
                   RowBox[{"Rest", "@", "sPolynomials"}], ",", 
                   "newSPolynomials"}], "]"}], "//", "PiecewiseExpand"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newArgs", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Append", "[", "reduced", "]"}], "[", 
                   "newPreGrobner", "]"}], ",", "newSPolynomials"}], "}"}], "//",
                 "PiecewiseExpand"}], "//", "PiecewiseListClean"}]}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"newArgs", "=", 
           RowBox[{
            RowBox[{
            "PiecewiseApplyConditionOperator", "[", "variables", "]"}], "[", 
            "newArgs", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"PiecewiseOperatorMap", "[", 
           RowBox[{"GrobOp", ",", "variables", ",", "newArgs"}], "]"}]}]}], 
        "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GrobOp", "[", "variables_", "]"}], "[", "preGrobner_List", "]"}],
    ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "newPreGrobner", ",", "sPolynomials", ",", "newArgs", ",", "facts"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"facts", "=", 
       RowBox[{"Lookup", "[", 
        RowBox[{"variables", ",", "\"\<facts\>\"", ",", "True"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"facts", "===", "False"}], ",", "$Failed", ",", 
          RowBox[{
           RowBox[{"newPreGrobner", "=", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"EchoLabel", "[", "\"\<monic preGrobner\>\"", "]"}], 
              "@"}], "*)"}], 
            RowBox[{
             RowBox[{"MonicOperator", "[", "variables", "]"}], "[", 
             "preGrobner", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"sPolynomials", "=", 
            RowBox[{
             RowBox[{"PiecewiseSPolynomialOperator", "[", "variables", "]"}], 
             "[", "newPreGrobner", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"newArgs", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"newPreGrobner", ",", "sPolynomials"}], "}"}], "//", 
              "PiecewiseExpand"}], "//", 
             RowBox[{
             "PiecewiseApplyConditionOperator", "[", "variables", "]"}]}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"PiecewiseOperatorMap", "[", 
              RowBox[{"GrobOp", ",", "variables", ",", "newArgs"}], "]"}], "//",
              "PiecewiseExpand"}], "//", 
            RowBox[{
            "PiecewiseBeautifyOperator", "[", "variables", "]"}]}]}]}], "]"}],
         "//", "PiecewiseExpand"}], "//", 
       RowBox[{"PiecewiseBeautifyOperator", "[", "variables", "]"}]}]}]}], 
    "]"}]}], ";"}], "\n"}], "Input",
 CellChangeTimes->{{3.8903694330088177`*^9, 3.890369504580755*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"c5e7b26b-b667-4f6c-ac88-7586caa837cc"]
},
WindowSize->{808, 897},
WindowMargins->{{436, Automatic}, {Automatic, 50}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"c8aa511d-9b2e-414d-be99-33ddb6ab94a5"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 320, 7, 73, "Input",ExpressionUUID->"f029474b-9f4c-422a-95f2-3b33fb52c3c6"],
Cell[903, 31, 714, 14, 46, "Message",ExpressionUUID->"44c99d28-9ba9-438f-8fcf-08f85bc543db"],
Cell[1620, 47, 740, 15, 46, "Message",ExpressionUUID->"7e9a0d98-ab06-4123-9d09-4e80f10500cb"],
Cell[2363, 64, 752, 14, 46, "Message",ExpressionUUID->"319149a0-bae3-43ee-a253-1f7f8c994415"],
Cell[3118, 80, 732, 14, 46, "Message",ExpressionUUID->"7456e43e-e6be-4447-8465-775b8ea6a91a"],
Cell[3853, 96, 749, 15, 46, "Message",ExpressionUUID->"f4236674-56a7-402b-a286-26e22e700b33"],
Cell[4605, 113, 758, 15, 46, "Message",ExpressionUUID->"30927003-f1d2-4939-bed8-62a479b16b13"],
Cell[5366, 130, 764, 15, 46, "Message",ExpressionUUID->"7e0a795a-2804-4399-9497-8747006abf79"],
Cell[6133, 147, 753, 14, 46, "Message",ExpressionUUID->"de29645d-88d9-4b52-bb69-53d68ad26a13"],
Cell[6889, 163, 734, 14, 46, "Message",ExpressionUUID->"91757e17-0755-4e42-bd42-5429731b15a9"],
Cell[7626, 179, 807, 15, 63, "Message",ExpressionUUID->"d28b707f-c315-47ed-9495-bd3229098cf9"],
Cell[8436, 196, 772, 14, 46, "Message",ExpressionUUID->"f22fa49c-27b2-4725-92e9-f2b09bad2814"],
Cell[9211, 212, 697, 14, 46, "Message",ExpressionUUID->"ab33739a-bb5c-4012-99e6-2bd762b213ab"]
}, Open  ]],
Cell[9923, 229, 16069, 427, 1942, "Input",ExpressionUUID->"c5e7b26b-b667-4f6c-ac88-7586caa837cc"]
}
]
*)

