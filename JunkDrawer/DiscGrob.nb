(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51386,       1493]
NotebookOptionsPosition[     46630,       1406]
NotebookOutlinePosition[     47077,       1423]
CellTagsIndexPosition[     47034,       1420]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Quit", "[", "]"}]], "Input",
 CellChangeTimes->{{3.892277984406221*^9, 3.892277985776258*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"815bed95-8910-47cc-879a-4af7b71ca473"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "Get", "[", 
   "\"\</Users/gomesd/Dropbox \
(Personal)/Work/trab/PDESymbolics2022/PDESymbolics2022/PDESymbolics2022.m\>\"\
", "]"}], ";"}]], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"7ac98466-41ba-4602-a146-35912442a841"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", "u", "}"}]}], ",", 
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<pars\>\"", "->", 
      RowBox[{"{", "a", "}"}]}], ",", " ", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"a", " ", 
         RowBox[{"u", "[", 
          RowBox[{"n", ",", 
           RowBox[{"t", "+", "1"}]}], "]"}]}], "-", " ", 
        RowBox[{"u", "[", 
         RowBox[{"n", ",", "t"}], "]"}]}], "}"}]}]}], "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TimeDifferenceOperator", "[", "variables", "]"}], "[", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}], "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.892276626686428*^9, 3.892276627074547*^9}, {
  3.89227669755564*^9, 3.892276697757259*^9}, {3.8922767607922373`*^9, 
  3.892276806063197*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"3c7ace1c-5b90-4509-b8b7-16064fa352b8"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {
        RowBox[{"\[LeftAssociation]", 
         RowBox[{
          RowBox[{"\<\"exp\"\>", "\[Rule]", "0"}], ",", 
          RowBox[{"\<\"scheme\"\>", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"-", 
             RowBox[{"u", "[", 
              RowBox[{"n", ",", "t"}], "]"}]}], "}"}]}]}], 
         "\[RightAssociation]"}], 
        RowBox[{"a", "\[Equal]", "0"}]},
       {
        RowBox[{"\[LeftAssociation]", 
         RowBox[{
          RowBox[{"\<\"exp\"\>", "\[Rule]", "0"}], ",", 
          RowBox[{"\<\"scheme\"\>", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}]}], "+", 
             RowBox[{"a", " ", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", 
                RowBox[{"1", "+", "t"}]}], "]"}]}]}], "}"}]}]}], 
         "\[RightAssociation]"}], 
        RowBox[{"a", "\[Equal]", "1"}]},
       {
        RowBox[{"\[LeftAssociation]", 
         RowBox[{
          RowBox[{"\<\"exp\"\>", "\[Rule]", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"u", "[", 
              RowBox[{"n", ",", "t"}], "]"}]}], "+", 
            FractionBox[
             RowBox[{"u", "[", 
              RowBox[{"n", ",", "t"}], "]"}], "a"]}]}], ",", 
          RowBox[{"\<\"scheme\"\>", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}]}], "+", 
             RowBox[{"a", " ", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", 
                RowBox[{"1", "+", "t"}]}], "]"}]}]}], "}"}]}]}], 
         "\[RightAssociation]"}], 
        RowBox[{
         RowBox[{"a", "\[NotEqual]", "0"}], "&&", 
         RowBox[{"a", "\[NotEqual]", "1"}], "&&", 
         RowBox[{
          SuperscriptBox["a", "2"], "\[NotEqual]", "a"}]}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{{3.89227669424039*^9, 3.8922766987188387`*^9}, {
   3.892276767493477*^9, 3.8922767778149652`*^9}, 3.8922768083980494`*^9, 
   3.892277006400846*^9, 3.892277236258062*^9, {3.892277958551794*^9, 
   3.8922780183390903`*^9}, 3.892278076943432*^9, 3.892278283789606*^9, 
   3.892278333426928*^9, 3.892278412743689*^9, 3.892278477197453*^9, {
   3.892278881344988*^9, 3.892278898785614*^9}, 3.8923737072018137`*^9, 
   3.8924388582920723`*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"b3cfcefe-8849-4d9d-bdb0-c00b74a9068f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code from friedmann paper", "Section",
 CellChangeTimes->{{3.8922792414238787`*^9, 
  3.892279249118137*^9}},ExpressionUUID->"e3779c44-c85e-431a-848b-\
64f28b2d053f"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"variables", "=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"\"\<indVars\>\"", "->", 
     RowBox[{"{", 
      RowBox[{"n", ",", "t"}], "}"}]}], ",", 
    RowBox[{"\"\<depVars\>\"", "->", 
     RowBox[{"{", "u", "}"}]}], ",", 
    RowBox[{"\"\<timeVars\>\"", "->", 
     RowBox[{"{", "t", "}"}]}]}], "]"}]}], "\n", 
 RowBox[{"expression", "=", 
  RowBox[{
   RowBox[{"u", "[", 
    RowBox[{"n", ",", 
     RowBox[{"t", "+", "1"}]}], "]"}], "-", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"PartialDVarDOperator", "[", "variables", "]"}], "[", "expression", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.892283215487948*^9, 3.892283215490821*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"8377f53b-224c-44dd-ab41-141598102a19"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"indVars\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"n", ",", "t"}], "}"}]}], ",", 
   RowBox[{"\<\"depVars\"\>", "\[Rule]", 
    RowBox[{"{", "u", "}"}]}], ",", 
   RowBox[{"\<\"timeVars\"\>", "\[Rule]", 
    RowBox[{"{", "t", "}"}]}]}], "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.892283217310607*^9, 3.892373715816414*^9},
 CellLabel->"Out[3]=",ExpressionUUID->"a2d08afd-38b2-4fc0-82f9-78c2b01b6084"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}], "+", 
  RowBox[{"u", "[", 
   RowBox[{"n", ",", 
    RowBox[{"1", "+", "t"}]}], "]"}]}]], "Output",
 CellChangeTimes->{3.892283217310607*^9, 3.892373715824841*^9},
 CellLabel->"Out[4]=",ExpressionUUID->"81747eb1-e2bf-4938-a27f-bac67079674f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"KroneckerDeltaOperator", "[", "t", "]"}]}], "+", 
   RowBox[{"KroneckerDeltaOperator", "[", 
    RowBox[{"1", "+", "t"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.892283217310607*^9, 3.892373715831771*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"a14c4ef1-6a47-44e3-9fd2-bab0ad622d61"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", "u", "}"}]}], ",", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"n", ",", 
          RowBox[{"t", "+", "1"}]}], "]"}], "-", 
        RowBox[{"u", "[", 
         RowBox[{"n", ",", "t"}], "]"}], "-", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"u", "[", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "-", 
           RowBox[{"u", "[", 
            RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"expression", "=", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   "expression", "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.8922793623817873`*^9, 3.892279374277978*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"7f5ded90-d534-4fcf-b12e-4d4bfc47a640"],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.892279366895493*^9, 3.89227937561689*^9}, 
   3.89237372096142*^9},
 CellLabel->"Out[8]=",ExpressionUUID->"c3b06db7-3dca-45a0-9abb-b657ad99da01"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", "u", "}"}]}], ",", 
     RowBox[{"\"\<pars\>\"", "->", 
      RowBox[{"{", "a", "}"}]}], ",", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"n", ",", 
          RowBox[{"t", "+", "1"}]}], "]"}], "-", 
        RowBox[{"u", "[", 
         RowBox[{"n", ",", "t"}], "]"}], "-", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"a", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"u", "[", 
               RowBox[{
                RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "-", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "a"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}], "-", 
              RowBox[{"u", "[", 
               RowBox[{
                RowBox[{"n", "-", "1"}], ",", "t"}], "]"}]}], ")"}]}]}], 
          ")"}]}]}], "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"expression", "=", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   "expression", "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.8922794036382723`*^9, 3.892279408735674*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"af180975-3e52-4f36-aaee-7a8940482b7f"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"False", 
        RowBox[{
         RowBox[{"a", "\[Equal]", "0"}], "||", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"2", " ", "a"}], "\[NotEqual]", "1"}], "&&", 
           RowBox[{
            RowBox[{"a", "+", 
             RowBox[{"2", " ", 
              SuperscriptBox["a", "3"]}]}], "\[NotEqual]", 
            RowBox[{"3", " ", 
             SuperscriptBox["a", "2"]}]}]}], ")"}], "||", 
         RowBox[{"a", "\[Equal]", "1"}]}]},
       {"True", 
        RowBox[{
         RowBox[{"2", " ", "a"}], "\[Equal]", "1"}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.89227941135738*^9, 3.8923737252250023`*^9},
 CellLabel->"Out[11]=",ExpressionUUID->"43f75814-a152-4ab3-9e5b-6bfced0f1391"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"variables", "=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"\"\<indVars\>\"", "->", 
     RowBox[{"{", 
      RowBox[{"n", ",", "t"}], "}"}]}], ",", 
    RowBox[{"\"\<depVars\>\"", "->", 
     RowBox[{"{", "u", "}"}]}], ",", 
    RowBox[{"\"\<pars\>\"", "->", 
     RowBox[{"{", "a", "}"}]}], ",", 
    RowBox[{"\"\<elimOrder\>\"", "->", "\"\<implicit\>\""}], ",", 
    RowBox[{"\"\<scheme\>\"", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"u", "[", 
        RowBox[{"n", ",", 
         RowBox[{"t", "+", "1"}]}], "]"}], "-", 
       RowBox[{"u", "[", 
        RowBox[{"n", ",", "t"}], "]"}], "-", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"n", ",", 
          RowBox[{"t", "+", "1"}]}], "]"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"u", "[", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "-", 
             RowBox[{"u", "[", 
              RowBox[{"n", ",", 
               RowBox[{"t", "+", "1"}]}], "]"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "a"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"u", "[", 
              RowBox[{"n", ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "-", 
             RowBox[{"u", "[", 
              RowBox[{
               RowBox[{"n", "-", "1"}], ",", 
               RowBox[{"t", "+", "1"}]}], "]"}]}], ")"}]}]}], ")"}]}]}], 
      "}"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}], "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.892279425585246*^9, 3.8922794293105927`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"6f4c5b51-81fa-4f2f-a5c4-0c37d4926b0e"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"indVars\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"n", ",", "t"}], "}"}]}], ",", 
   RowBox[{"\<\"depVars\"\>", "\[Rule]", 
    RowBox[{"{", "u", "}"}]}], ",", 
   RowBox[{"\<\"pars\"\>", "\[Rule]", 
    RowBox[{"{", "a", "}"}]}], ",", 
   RowBox[{"\<\"elimOrder\"\>", "\[Rule]", "\<\"implicit\"\>"}], ",", 
   RowBox[{"\<\"scheme\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"u", "[", 
        RowBox[{"n", ",", "t"}], "]"}]}], "+", 
      RowBox[{"u", "[", 
       RowBox[{"n", ",", 
        RowBox[{"1", "+", "t"}]}], "]"}], "-", 
      RowBox[{
       RowBox[{"u", "[", 
        RowBox[{"n", ",", 
         RowBox[{"1", "+", "t"}]}], "]"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "a"}], ")"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"u", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "1"}], "+", "n"}], ",", 
               RowBox[{"1", "+", "t"}]}], "]"}]}], "+", 
            RowBox[{"u", "[", 
             RowBox[{"n", ",", 
              RowBox[{"1", "+", "t"}]}], "]"}]}], ")"}]}], "+", 
         RowBox[{"a", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"u", "[", 
              RowBox[{"n", ",", 
               RowBox[{"1", "+", "t"}]}], "]"}]}], "+", 
            RowBox[{"u", "[", 
             RowBox[{
              RowBox[{"1", "+", "n"}], ",", 
              RowBox[{"1", "+", "t"}]}], "]"}]}], ")"}]}]}], ")"}]}]}], 
     "}"}]}]}], "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.892279430484*^9, 3.892373729766708*^9},
 CellLabel->"Out[12]=",ExpressionUUID->"96753e8f-8333-42bd-a86e-8955bc2d8d01"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"False", 
        RowBox[{
         RowBox[{"a", "\[Equal]", "0"}], "||", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"2", " ", "a"}], "\[NotEqual]", "1"}], "&&", 
           RowBox[{
            RowBox[{"a", "+", 
             RowBox[{"2", " ", 
              SuperscriptBox["a", "3"]}]}], "\[NotEqual]", 
            RowBox[{"3", " ", 
             SuperscriptBox["a", "2"]}]}]}], ")"}], "||", 
         RowBox[{"a", "\[Equal]", "1"}]}]},
       {"True", 
        RowBox[{
         RowBox[{"2", " ", "a"}], "\[Equal]", "1"}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.892279430484*^9, 3.892373731245717*^9},
 CellLabel->"Out[13]=",ExpressionUUID->"1257f3f4-b0c3-495b-a49f-f86ec69c46f6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"v", ",", "m"}], "}"}]}], ",", 
     RowBox[{"\"\<display result\>\"", "->", "True"}], ",", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"n", ",", 
           RowBox[{"t", "+", "1"}]}], "]"}], "-", 
         RowBox[{"v", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "^", "2"}], "/", 
            "2"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "^", "2"}], "/", 
            "2"}]}], ")"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"n", ",", "t"}], "]"}], "^", "2"}], "/", "2"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"n", ",", "t"}], "]"}], "^", "2"}], "/", "2"}]}], 
          ")"}]}], ",", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"n", ",", 
           RowBox[{"t", "+", "1"}]}], "]"}], "-", 
         RowBox[{"m", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "t"}], "]"}]}], ")"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"n", ",", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"n", ",", "t"}], "]"}], ",", 
     RowBox[{"m", "[", 
      RowBox[{"n", ",", "t"}], "]"}]}], "}"}], "]"}], "//", 
  "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.892279482523635*^9, 3.89227949697885*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"2c9d4858-1118-486d-9333-4d681afc704c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0"}], "}"}]], "Print",
 CellChangeTimes->{{3.892279488218645*^9, 3.892279498599828*^9}, 
   3.892373757440675*^9},
 CellLabel->
  "During evaluation of \
In[14]:=",ExpressionUUID->"64661a9a-1c0c-40c3-9e24-783b53e34fef"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0"}], "}"}]], "Print",
 CellChangeTimes->{{3.892279488218645*^9, 3.892279498599828*^9}, 
   3.892373757656864*^9},
 CellLabel->
  "During evaluation of \
In[14]:=",ExpressionUUID->"f085e085-705e-4621-b8ef-83a7d192bc36"]
}, Open  ]],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.892279492251923*^9, 3.8922794987909813`*^9}, 
   3.892373757666407*^9},
 CellLabel->"Out[15]=",ExpressionUUID->"f8804b89-0b0d-429a-acb3-fbd8ad105b4c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", "n", "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"v", ",", "m"}], "}"}]}], ",", 
     RowBox[{"\"\<rhs\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"v", "[", "n", "]"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"n", "+", "1"}], "]"}], "^", "2"}], "/", "2"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"n", "+", "1"}], "]"}], "^", "2"}], "/", "2"}]}], ")"}],
          "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", "n", "]"}], "^", "2"}], "/", "2"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", "n", "]"}], "^", "2"}], "/", "2"}]}], ")"}]}], 
        ",", 
        RowBox[{
         RowBox[{"m", "[", "n", "]"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"n", "+", "1"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{"n", "+", "1"}], "]"}]}], ")"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", "n", "]"}], "*", 
           RowBox[{"v", "[", "n", "]"}]}], ")"}]}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", "n", "]"}], ",", 
     RowBox[{"m", "[", "n", "]"}]}], "}"}], "]"}], "//", 
  "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.8922795113306217`*^9, 3.892279515184157*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"482b1d0a-6610-442b-847d-7fe6d78cb4f7"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.8922795160138483`*^9, 3.8923737606400642`*^9},
 CellLabel->"Out[17]=",ExpressionUUID->"55089727-2353-4ce8-ac54-3d26d0f3c14e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", " ", "=", " ", 
   RowBox[{"Association", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "t"}], "}"}]}], ",", "\n", "\t\t", 
     RowBox[{"\"\<depVars\>\"", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"v", ",", " ", "m"}], "}"}]}], ",", "\n", "\t\t", 
     RowBox[{"\"\<VarDOperator\>\"", "->", "PartialDVarDOperator"}], ",", 
     "\n", "\t\t", 
     RowBox[{"\"\<timeVars\>\"", "->", 
      RowBox[{"{", "t", "}"}]}], ",", "\n", "\t\t", 
     RowBox[{"\"\<eqRhs\>\"", " ", "->", " ", 
      RowBox[{"{", " ", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{
               RowBox[{"n", " ", "+", " ", "1"}], ",", " ", "t"}], "]"}], "^",
              "2"}], "/", "2"}], " ", "-", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{
               RowBox[{"n", " ", "+", " ", "1"}], ",", " ", "t"}], "]"}], "^",
              "2"}], "/", "2"}]}], ")"}], " ", "-", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"n", ",", " ", "t"}], "]"}], "^", "2"}], "/", "2"}], 
           " ", "-", " ", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"n", ",", " ", "t"}], "]"}], "^", "2"}], "/", "2"}]}], 
          ")"}]}], ",", " ", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{
             RowBox[{"n", " ", "+", " ", "1"}], ",", " ", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{
             RowBox[{"n", " ", "+", " ", "1"}], ",", " ", "t"}], "]"}]}], 
          ")"}], " ", "-", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"n", ",", " ", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{"n", ",", " ", "t"}], "]"}]}], ")"}]}]}], "}"}]}]}], "\n",
     "\t\t", "]"}]}], ";"}], "\n", 
 RowBox[{"\t\t", 
  RowBox[{
   RowBox[{
    RowBox[{"FindConservedQuantityBasisOperator", "[", "variables", "]"}], 
    "[", 
    RowBox[{"Association", "[", 
     RowBox[{
      RowBox[{"\"\<degree\>\"", "->", "4"}], ",", 
      RowBox[{"\"\<generators\>\"", "->", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"n", ",", "t"}], "]"}], ",", 
         RowBox[{"m", "[", 
          RowBox[{"n", ",", "t"}], "]"}]}], "}"}]}]}], "]"}], "]"}], "//", 
   "QuietEcho"}]}]}], "Input",
 CellChangeTimes->{{3.8922795269015017`*^9, 3.892279530692232*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"f360fd2d-3a56-489e-8d70-d1d08fad18f9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"m", "[", 
    RowBox[{"n", ",", "t"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.892279535371331*^9},
 CellLabel->"Out[21]=",ExpressionUUID->"e8a638c0-c014-40f7-8cbd-261601150471"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"m", ",", "v"}], "}"}]}], ",", 
     RowBox[{"\"\<elimOrder\>\"", "->", "\"\<explicitimplicit\>\""}], ",", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"v", "[", 
             RowBox[{"n", ",", 
              RowBox[{"t", "+", "1"}]}], "]"}], "-", 
            RowBox[{"v", "[", 
             RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "^", "2"}], "/", "2"}], "-", 
           
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "^", "2"}], "/", "2"}]}], 
          ")"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"n", ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "^", "2"}], "/", "2"}], "-", 
           
           RowBox[{
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"n", ",", 
               RowBox[{"t", "+", "1"}]}], "]"}], "^", "2"}], "/", "2"}]}], 
          ")"}]}], ",", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"n", ",", 
           RowBox[{"t", "+", "1"}]}], "]"}], "-", 
         RowBox[{"m", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ",", "t"}], "]"}]}], ")"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"n", ",", "t"}], "]"}], "*", 
           RowBox[{"v", "[", 
            RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"n", ",", "t"}], "]"}], ",", 
     RowBox[{"m", "[", 
      RowBox[{"n", ",", "t"}], "]"}]}], "}"}], "]"}], "//", 
  "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.892279555678007*^9, 3.892279559894187*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"7c5687d7-c041-4862-92d2-5cf96440ccd0"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.8922795618549547`*^9},
 CellLabel->"Out[23]=",ExpressionUUID->"8177c0a5-38f0-49dc-8b9d-d067cdff7554"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{"\"\<indVars\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"n", ",", "t"}], "}"}]}], ",", 
     RowBox[{"\"\<depVars\>\"", "->", 
      RowBox[{"{", "u", "}"}]}], ",", 
     RowBox[{"\"\<pars\>\"", "->", 
      RowBox[{"{", "a", "}"}]}], ",", 
     RowBox[{"\"\<scheme\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"n", ",", 
          RowBox[{"t", "+", "1"}]}], "]"}], "-", 
        RowBox[{"u", "[", 
         RowBox[{"n", ",", "t"}], "]"}], "-", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{"n", ",", "t"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"a", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"u", "[", 
               RowBox[{
                RowBox[{"n", "+", "1"}], ",", "t"}], "]"}], "-", 
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "a"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"u", "[", 
               RowBox[{"n", ",", "t"}], "]"}], "-", 
              RowBox[{"u", "[", 
               RowBox[{
                RowBox[{"n", "-", "1"}], ",", "t"}], "]"}]}], ")"}]}]}], 
          ")"}]}]}], "}"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"expression", "=", 
   RowBox[{"u", "[", 
    RowBox[{"n", ",", "t"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   "expression", "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.892373644150752*^9, 3.8923736616784983`*^9}, {
  3.892438865366549*^9, 3.8924388680726633`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"f4319e5c-5019-467b-a326-9403f41ca638"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"False", 
        RowBox[{
         RowBox[{"a", "\[Equal]", "0"}], "||", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"2", " ", "a"}], "\[NotEqual]", "1"}], "&&", 
           RowBox[{
            RowBox[{"a", "+", 
             RowBox[{"2", " ", 
              SuperscriptBox["a", "3"]}]}], "\[NotEqual]", 
            RowBox[{"3", " ", 
             SuperscriptBox["a", "2"]}]}]}], ")"}], "||", 
         RowBox[{"a", "\[Equal]", "1"}]}]},
       {"True", 
        RowBox[{
         RowBox[{"2", " ", "a"}], "\[Equal]", "1"}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.892373680855122*^9, 3.892438870182617*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"bfd1af3c-69a0-4aaa-a6e1-077b6e0f1d59"]
}, Open  ]],

Cell[BoxData["|"], "Input",
 CellChangeTimes->{
  3.892438868653809*^9},ExpressionUUID->"7d582226-2cd1-4a70-a129-\
09fa45f6f58c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Possible additional code", "Section",
 CellChangeTimes->{{3.892347006095044*^9, 
  3.892347011439145*^9}},ExpressionUUID->"0d718e22-49eb-4617-8c51-\
61a9665e0687"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"variables", "=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"\"\<indVars\>\"", "->", 
     RowBox[{"{", "n", "}"}]}], ",", 
    RowBox[{"\"\<pars\>\"", "->", 
     RowBox[{"{", "a", "}"}]}], ",", 
    RowBox[{"\"\<depVars\>\"", "->", 
     RowBox[{"{", "u", "}"}]}], ",", 
    RowBox[{"\"\<rhs\>\"", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"u", "[", "n", "]"}], "+", 
       RowBox[{"a", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"u", "[", 
           RowBox[{"n", "+", "1"}], "]"}], "-", 
          RowBox[{"2", "*", 
           RowBox[{"u", "[", "n", "]"}]}], "+", 
          RowBox[{"u", "[", 
           RowBox[{"n", "-", "1"}], "]"}]}], ")"}]}]}], "}"}]}]}], 
   "]"}]}], "\n", 
 RowBox[{"expression", "=", 
  RowBox[{
   RowBox[{"u", "[", "n", "]"}], "^", "2"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   "expression", "]"}], "//", "QuietEcho"}]}], "Input",
 CellLabel->"In[9]:=",ExpressionUUID->"287c6f30-69cd-4beb-a957-b762210c21a0"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"indVars\"\>", "\[Rule]", 
    RowBox[{"{", "n", "}"}]}], ",", 
   RowBox[{"\<\"pars\"\>", "\[Rule]", 
    RowBox[{"{", "a", "}"}]}], ",", 
   RowBox[{"\<\"depVars\"\>", "\[Rule]", 
    RowBox[{"{", "u", "}"}]}], ",", 
   RowBox[{"\<\"rhs\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"u", "[", "n", "]"}], "+", 
      RowBox[{"a", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{
           RowBox[{"-", "1"}], "+", "n"}], "]"}], "-", 
         RowBox[{"2", " ", 
          RowBox[{"u", "[", "n", "]"}]}], "+", 
         RowBox[{"u", "[", 
          RowBox[{"1", "+", "n"}], "]"}]}], ")"}]}]}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.892438919930868*^9},
 CellLabel->"Out[9]=",ExpressionUUID->"a70f6e21-fafa-4f28-a98a-f124dc44a905"],

Cell[BoxData[
 SuperscriptBox[
  RowBox[{"u", "[", "n", "]"}], "2"]], "Output",
 CellChangeTimes->{3.892438919937016*^9},
 CellLabel->"Out[10]=",ExpressionUUID->"ad21633f-2e53-43a4-b306-755a36e31784"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"True", 
        RowBox[{"a", "\[Equal]", "0"}]},
       {"False", 
        RowBox[{
         RowBox[{"a", "\[NotEqual]", "0"}], "&&", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"2", " ", "a"}], "\[Equal]", "1"}], "||", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"2", " ", 
               SuperscriptBox["a", "2"]}], "\[NotEqual]", "a"}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"3", " ", "a"}], "\[Equal]", "2"}], "||", 
               RowBox[{
                RowBox[{"a", " ", 
                 RowBox[{"(", 
                  RowBox[{"2", "-", 
                   RowBox[{"7", " ", "a"}], "+", 
                   RowBox[{"6", " ", 
                    SuperscriptBox["a", "2"]}]}], ")"}]}], "\[NotEqual]", 
                "0"}]}], ")"}]}], ")"}]}], ")"}]}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.8924389204541388`*^9},
 CellLabel->"Out[11]=",ExpressionUUID->"9b9623a8-b68d-4321-a43b-5aacce2baafb"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"variables", "=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"\"\<indVars\>\"", "->", 
     RowBox[{"{", "n", "}"}]}], ",", 
    RowBox[{"\"\<pars\>\"", "->", 
     RowBox[{"{", "a", "}"}]}], ",", 
    RowBox[{"\"\<depVars\>\"", "->", 
     RowBox[{"{", "u", "}"}]}], ",", 
    RowBox[{"\"\<rhs\>\"", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"u", "[", "n", "]"}], "+", 
       RowBox[{"a", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"u", "[", 
           RowBox[{"n", "+", "1"}], "]"}], "-", 
          RowBox[{"2", "*", 
           RowBox[{"u", "[", "n", "]"}]}], "+", 
          RowBox[{"u", "[", 
           RowBox[{"n", "-", "1"}], "]"}]}], ")"}]}]}], "}"}]}]}], 
   "]"}]}], "\n", 
 RowBox[{"expression", "=", 
  RowBox[{
   RowBox[{"u", "[", "n", "]"}], "^", "2"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteConservedQOperator", "[", "variables", "]"}], "[", 
   "expression", "]"}], "//", "QuietEcho"}]}], "Input",
 CellChangeTimes->{{3.89234701231737*^9, 3.8923470563895283`*^9}, {
  3.892347107841511*^9, 3.892347108949932*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"f46d3427-aa8d-4876-81f7-0194b59921c7"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"indVars\"\>", "\[Rule]", 
    RowBox[{"{", "n", "}"}]}], ",", 
   RowBox[{"\<\"pars\"\>", "\[Rule]", 
    RowBox[{"{", "a", "}"}]}], ",", 
   RowBox[{"\<\"depVars\"\>", "\[Rule]", 
    RowBox[{"{", "u", "}"}]}], ",", 
   RowBox[{"\<\"rhs\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"u", "[", "n", "]"}], "+", 
      RowBox[{"a", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"u", "[", 
          RowBox[{
           RowBox[{"-", "1"}], "+", "n"}], "]"}], "-", 
         RowBox[{"2", " ", 
          RowBox[{"u", "[", "n", "]"}]}], "+", 
         RowBox[{"u", "[", 
          RowBox[{"1", "+", "n"}], "]"}]}], ")"}]}]}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.892347033616373*^9, 3.892347085520074*^9, 
  3.892347126278399*^9, 3.8924388784454403`*^9},
 CellLabel->"Out[6]=",ExpressionUUID->"1ab94363-3761-4415-ae09-2faf63f2a44b"],

Cell[BoxData[
 SuperscriptBox[
  RowBox[{"u", "[", "n", "]"}], "2"]], "Output",
 CellChangeTimes->{3.892347033616373*^9, 3.892347085520074*^9, 
  3.892347126278399*^9, 3.892438878453405*^9},
 CellLabel->"Out[7]=",ExpressionUUID->"f0618df6-fb30-421b-aadb-b77a3148ebb7"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"True", 
        RowBox[{"a", "\[Equal]", "0"}]},
       {"False", 
        RowBox[{
         RowBox[{"a", "\[NotEqual]", "0"}], "&&", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"2", " ", "a"}], "\[Equal]", "1"}], "||", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"2", " ", 
               SuperscriptBox["a", "2"]}], "\[NotEqual]", "a"}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"3", " ", "a"}], "\[Equal]", "2"}], "||", 
               RowBox[{
                RowBox[{"a", " ", 
                 RowBox[{"(", 
                  RowBox[{"2", "-", 
                   RowBox[{"7", " ", "a"}], "+", 
                   RowBox[{"6", " ", 
                    SuperscriptBox["a", "2"]}]}], ")"}]}], "\[NotEqual]", 
                "0"}]}], ")"}]}], ")"}]}], ")"}]}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.892347033616373*^9, 3.892347085520074*^9, 
  3.892347126278399*^9, 3.89243887896419*^9},
 CellLabel->"Out[8]=",ExpressionUUID->"ce77bfa4-76f0-4f0f-a1ef-18cb4ab3f321"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"%", "//", 
  RowBox[{"PiecewiseBeautifyOperator", "[", "variables", "]"}]}]], "Input",
 CellChangeTimes->{{3.892438944865629*^9, 3.8924389532272873`*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"20736221-f8e6-4d51-8aa6-199269872adb"],

Cell[BoxData[
 RowBox[{
  TagBox["\<\"PiecewiseBeautify:  qq\"\>",
   "EchoLabel"], "  ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"a", "\[Equal]", "0"}], ",", 
    RowBox[{
     RowBox[{"a", "\[Equal]", 
      FractionBox["1", "2"]}], "||", 
     RowBox[{"a", "\[Equal]", 
      FractionBox["2", "3"]}], "||", 
     RowBox[{
      RowBox[{"6", " ", "a"}], "\[NotEqual]", "0"}]}], ",", "False"}], 
   "}"}]}]], "Echo",
 CellChangeTimes->{
  3.892438954015539*^9},ExpressionUUID->"c25ba400-e526-4d39-9053-\
178d6056ef78"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\[Piecewise]", GridBox[{
       {"True", 
        RowBox[{"a", "\[Equal]", "0"}]},
       {"False", 
        RowBox[{"a", "\[NotEqual]", "0"}]},
       {"$Failed", 
        TagBox["True",
         "PiecewiseDefault",
         AutoDelete->True]}
      },
      AllowedDimensions->{2, Automatic},
      Editable->True,
      GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
      GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.84]}, 
          Offset[0.27999999999999997`]}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}},
      Selectable->True]}
   },
   GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.35]}, 
       Offset[0.27999999999999997`]}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}}],
  "Piecewise",
  DeleteWithContents->True,
  Editable->False,
  SelectWithContents->True,
  Selectable->False,
  StripWrapperBoxes->True]], "Output",
 CellChangeTimes->{3.892438954052809*^9},
 CellLabel->"Out[12]=",ExpressionUUID->"940fda6c-5e3b-4b58-8c2f-874781b16e96"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{808, 911},
WindowMargins->{{Automatic, -1074}, {Automatic, 122}},
TaggingRules->Association["TryRealOnly" -> False],
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"9f26586d-70d7-4d65-bdba-5c689000d626"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 197, 3, 30, "Input",ExpressionUUID->"815bed95-8910-47cc-879a-4af7b71ca473"],
Cell[758, 25, 265, 7, 73, "Input",ExpressionUUID->"7ac98466-41ba-4602-a146-35912442a841"],
Cell[CellGroupData[{
Cell[1048, 36, 1118, 30, 73, "Input",ExpressionUUID->"3c7ace1c-5b90-4509-b8b7-16064fa352b8"],
Cell[2169, 68, 3620, 97, 101, "Output",ExpressionUUID->"b3cfcefe-8849-4d9d-bdb0-c00b74a9068f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5826, 170, 172, 3, 67, "Section",ExpressionUUID->"e3779c44-c85e-431a-848b-64f28b2d053f"],
Cell[CellGroupData[{
Cell[6023, 177, 805, 22, 73, "Input",ExpressionUUID->"8377f53b-224c-44dd-ab41-141598102a19"],
Cell[6831, 201, 494, 11, 37, "Output",ExpressionUUID->"a2d08afd-38b2-4fc0-82f9-78c2b01b6084"],
Cell[7328, 214, 341, 9, 34, "Output",ExpressionUUID->"81747eb1-e2bf-4938-a27f-bac67079674f"],
Cell[7672, 225, 360, 8, 34, "Output",ExpressionUUID->"a14c4ef1-6a47-44e3-9fd2-bab0ad622d61"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8069, 238, 1317, 38, 94, "Input",ExpressionUUID->"7f5ded90-d534-4fcf-b12e-4d4bfc47a640"],
Cell[9389, 278, 200, 3, 34, "Output",ExpressionUUID->"c3b06db7-3dca-45a0-9abb-b657ad99da01"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9626, 286, 1869, 53, 136, "Input",ExpressionUUID->"af180975-3e52-4f36-aaee-7a8940482b7f"],
Cell[11498, 341, 1871, 54, 73, "Output",ExpressionUUID->"43f75814-a152-4ab3-9e5b-6bfced0f1391"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13406, 400, 1977, 55, 136, "Input",ExpressionUUID->"6f4c5b51-81fa-4f2f-a5c4-0c37d4926b0e"],
Cell[15386, 457, 1870, 53, 80, "Output",ExpressionUUID->"96753e8f-8333-42bd-a86e-8955bc2d8d01"],
Cell[17259, 512, 1867, 54, 73, "Output",ExpressionUUID->"1257f3f4-b0c3-495b-a49f-f86ec69c46f6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19163, 571, 2629, 78, 115, "Input",ExpressionUUID->"2c9d4858-1118-486d-9333-4d681afc704c"],
Cell[CellGroupData[{
Cell[21817, 653, 269, 7, 24, "Print",ExpressionUUID->"64661a9a-1c0c-40c3-9e24-783b53e34fef"],
Cell[22089, 662, 269, 7, 24, "Print",ExpressionUUID->"f085e085-705e-4621-b8ef-83a7d192bc36"]
}, Open  ]],
Cell[22373, 672, 204, 3, 34, "Output",ExpressionUUID->"f8804b89-0b0d-429a-acb3-fbd8ad105b4c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22614, 680, 1914, 57, 94, "Input",ExpressionUUID->"482b1d0a-6610-442b-847d-7fe6d78cb4f7"],
Cell[24531, 739, 178, 2, 34, "Output",ExpressionUUID->"55089727-2353-4ce8-ac54-3d26d0f3c14e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24746, 746, 2914, 79, 283, "Input",ExpressionUUID->"f360fd2d-3a56-489e-8d70-d1d08fad18f9"],
Cell[27663, 827, 302, 8, 34, "Output",ExpressionUUID->"e8a638c0-c014-40f7-8cbd-261601150471"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28002, 840, 2891, 86, 136, "Input",ExpressionUUID->"7c5687d7-c041-4862-92d2-5cf96440ccd0"],
Cell[30896, 928, 154, 2, 34, "Output",ExpressionUUID->"8177c0a5-38f0-49dc-8b9d-d067cdff7554"]
}, Open  ]],
Cell[CellGroupData[{
Cell[31087, 935, 1937, 54, 136, "Input",ExpressionUUID->"f4319e5c-5019-467b-a326-9403f41ca638"],
Cell[33027, 991, 1869, 54, 73, "Output",ExpressionUUID->"bfd1af3c-69a0-4aaa-a6e1-077b6e0f1d59"]
}, Open  ]],
Cell[34911, 1048, 129, 3, 30, "Input",ExpressionUUID->"7d582226-2cd1-4a70-a129-09fa45f6f58c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[35077, 1056, 169, 3, 67, "Section",ExpressionUUID->"0d718e22-49eb-4617-8c51-61a9665e0687"],
Cell[CellGroupData[{
Cell[35271, 1063, 1075, 31, 94, "Input",ExpressionUUID->"287c6f30-69cd-4beb-a957-b762210c21a0"],
Cell[36349, 1096, 897, 25, 37, "Output",ExpressionUUID->"a70f6e21-fafa-4f28-a98a-f124dc44a905"],
Cell[37249, 1123, 200, 4, 34, "Output",ExpressionUUID->"ad21633f-2e53-43a4-b306-755a36e31784"],
Cell[37452, 1129, 2200, 63, 73, "Output",ExpressionUUID->"9b9623a8-b68d-4321-a43b-5aacce2baafb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39689, 1197, 1191, 33, 94, "Input",ExpressionUUID->"f46d3427-aa8d-4876-81f7-0194b59921c7"],
Cell[40883, 1232, 968, 26, 37, "Output",ExpressionUUID->"1ab94363-3761-4415-ae09-2faf63f2a44b"],
Cell[41854, 1260, 268, 5, 34, "Output",ExpressionUUID->"f0618df6-fb30-421b-aadb-b77a3148ebb7"],
Cell[42125, 1267, 2265, 64, 96, "Output",ExpressionUUID->"ce77bfa4-76f0-4f0f-a1ef-18cb4ab3f321"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44427, 1336, 257, 4, 30, "Input",ExpressionUUID->"20736221-f8e6-4d51-8aa6-199269872adb"],
Cell[44687, 1342, 520, 17, 40, "Echo",ExpressionUUID->"c25ba400-e526-4d39-9053-178d6056ef78"],
Cell[45210, 1361, 1392, 41, 69, "Output",ExpressionUUID->"940fda6c-5e3b-4b58-8c2f-874781b16e96"]
}, Open  ]]
}, Open  ]]
}
]
*)

